<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom URL Shortener</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; text-align: center; background: #f4f4f4; }
        h1 { color: #333; }
        input, button { padding: 10px; margin: 10px; font-size: 16px; width: 80%; max-width: 400px; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        #result { margin: 20px; font-size: 18px; word-break: break-all; }
        .error { color: red; }
        a { color: #007bff; }
    </style>
</head>
<body>
    <h1>Custom URL Shortener</h1>
    <p>Enter a long URL and a custom short text (e.g., "etg" or "my-site").</p>

    <input type="text" id="longUrl" placeholder="Long URL (e.g., https://elios-training-grounds.weebly.com/)">
    <br>
    <input type="text" id="customSlug" placeholder="Custom short text (letters, numbers, -, _ only — no spaces)">
    <br>
    <button onclick="createShortLink()">Create Short Link</button>

    <div id="result"></div>

    <script>
        // Check if this page is being accessed as a short link (e.g., /my-site)
        const path = window.location.pathname.substring(1); // Remove leading /
        if (path) {
            const redirects = JSON.parse(localStorage.getItem('redirects') || '{}');
            const target = redirects[path];
            if (target) {
                document.write(`
                    <p>Redirecting to <a href="${target}">${target}</a>...</p>
                    <meta http-equiv="refresh" content="0; url=${target}">
                `);
                window.location.href = target; // JS fallback
            } else {
                document.write('<p>Short link not found. <a href="/">Go home</a></p>');
            }
        }

        function createShortLink() {
            const longUrlInput = document.getElementById('longUrl').value.trim();
            const slugInput = document.getElementById('customSlug').value.trim();

            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '';
            resultDiv.className = '';

            // Validate long URL
            let url;
            try {
                url = new URL(longUrlInput.startsWith('http') ? longUrlInput : 'https://' + longUrlInput);
            } catch (e) {
                resultDiv.innerHTML = '<span class="error">Invalid long URL — must be a full valid URL (include https://).</span>';
                return;
            }

            // Validate slug
            if (!slugInput) {
                resultDiv.innerHTML = '<span class="error">Custom short text is required.</span>';
                return;
            }
            if (!/^[a-zA-Z0-9_-]+$/.test(slugInput)) {
                resultDiv.innerHTML = '<span class="error">Custom text can only contain letters, numbers, hyphens (-), and underscores (_). No spaces or special characters.</span>';
                return;
            }

            // Save redirect
            const redirects = JSON.parse(localStorage.getItem('redirects') || '{}');
            redirects[slugInput] = url.href;
            localStorage.setItem('redirects', JSON.stringify(redirects));

            // Generate short link
            const shortLink = `${window.location.origin}/${slugInput}`;

            resultDiv.innerHTML = `
                <strong>Success!</strong><br>
                Your short link: <a href="${shortLink}" target="_blank">${shortLink}</a><br><br>
                It redirects to: ${url.href}
            `;
        }
    </script>

    <p><small>Powered by GitHub Pages • Redirects stored in your browser only.</small></p>
</body>
</html>
